# Recommendation H.264: Advanced Video Coding

By [vcodex.com](https://www.vcodex.com/an-overview-of-h264-advanced-video-coding/)

## 1 What is H.264?

H.264 is an industry standard for video compression. It defines a format or syntax for compressed video and a method for decoding this syntax to produce a displayable video sequence. The document does not actually specify how to encode (compress) digital video, this is left for the manufacturer of the video encoder.

![[h264_intro_1.png]]

## 2 How does an H.264 codec work?

An H.264 video encoder carries out _prediction_, _transform_ and _encoding_ processes, in order to produce a compressed H.264 bitstream.

### 2.1 Encoder processes

#### Prediction

The encoder processes a frame of video in units of a **Macroblock** (16x16 displayed pixels). It forms a **prediction** of the macroblock based on previously-coded data, either from the current frame (**intra** prediction) or from other frames that have already been coded and transmitted (**inter** prediction). The encoder subtracts the prediction from the current macroblock to form a residual¹.

**Intra** prediction uses 16x16 and 4x4 block sizes to predict the macroblock from surrounding, previously-coded pixels within the same frame.

![[intra-preds.png]]

**Inter** prediction uses a range of block sizes (from 16x16 down to 4x4) to predict pixels in the current frame from similar regions in previously-coded frames.

![[inter-preds.png]]

¹ Finding a suitable inter prediction is often described as **motion estimation**. Subtracting an inter prediction from the current macroblock is **motion compensation**.

#### Transform and quantization

A block of residual samples is transformed using a 4x4 or 8x8 **integer transform**, an approximate form of the Discrete Cosine Transform (DCT). The transform outputs a set of **coefficients**, each of which is a weighting value for a standard basis pattern. When combined, the weighted basis patterns re-create the block of residual samples.

![[dct-transform.png]]

The output of the transform, a block of transform coefficients, is **quantized**, i.e. each coefficient is divided by an integer value. Quantization reduces the precision of the transform coefficients according to a quantization parameter (QP). The result is a block in which most or all of the coefficients are zero, with a few non-zero coefficients. The bigger the QP value is, the more coefficients are set to zero, resulting in a higher compression rate at the expense of image quality. The lower the QP, the better the quality of the decompressed image, at the expense of compression ratio.

#### Bitstream encoding

The video coding process produces a number of values that must be **encoded** to form the compressed bitstream. These values include:

- Quantized transform coefficients
- information to enable the decoder to re-create the prediction
- information about the structure of the compressed data and the compression tools used during encoding
- information about the complete video sequence.

These values and parameters (**syntax elements**) are converted into binary codes using **variable length coding** and/or **arithmetic coding**. Each of these encoding methods produces an efficient, compact binary representation of the information. The encoded bitstream can then be stored and/or transmitted.

### 2.2 Decoder processes

#### Bitstream decoding

A video decoder receives the compressed H.264 bitstream, decodes each of the syntax elements and extracts the information described above (quantized transform coefficients, prediction information, etc.). This information is then used to reverse the coding process and recreate a sequence of video images.

#### Rescaling and inverse transform

The quantized transform coefficients are **re-scaled**. Each coefficient is multiplied by an integer value to restore its original scale. An inverse transform combines the standard basis patterns, weighted by the re-scaled coefficients, to re-create each block of residual data. These blocks are combined to form a residual macroblock.

#### Reconstruction

For each macroblock, the decoder forms an identical prediction to the one created by the encoder. The decoder adds the prediction to the decoded residual to **reconstruct** a decoded macroblock which can then be displayed as part of a video frame.

## 3 H.264 in practice


